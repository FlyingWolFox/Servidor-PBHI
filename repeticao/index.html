<!DOCTYPE html>
<html lang="pt-br">

<head>

    <title>Tem L√≥gica - Jogo da Repeti√ß√£o</title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#FDC23E">
    <meta name="apple-mobile-web-app-status-bar-style" content="#FDC23E">

    <!-- chamada para as folhas de estilo -->
    <link rel="stylesheet" href="../style/page-style.css">
    <!-- chamada para as folhas de estilo do jogo -->
    <link rel="stylesheet" href="game-style.css">
    <link rel="stylesheet" id="estilo-mobile" href="mobile-style.css" type="text/css"
        media="screen and (orientation: landscape) and (max-width: 900px)">

    <link rel="shortcut icon" href="../img/favicon.ico" />

    <!-- link para os icones me forma de fonte -->

    <link rel="stylesheet" href="../style/icofont/icofont.min.css">

    <!-- link para as fontes do projeto -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@100;300;400;500;700;800;900&display=swap"
        rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
	<script src='https://code.responsivevoice.org/responsivevoice.js'></script>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=KONwxqZY"></script>

    <script type="text/javascript" src="common/jquery.min.js"></script>
    <script type="text/javascript" src="common/jquery-ui.min.js"></script>

    <script src="Scripts/MindFusion.Common.js" type="text/javascript"></script>
    <script src="Scripts/MindFusion.Diagramming.js" type="text/javascript"></script>

</head>

<body class='game-body'>
    <select id='voiceList' hidden></select> <br><br> 
    <section class="aviso-orientacao">
        <div id="aviso-orientacao-caixa">
            <h1 id="texto-orientacao"> vire seu aparelho na horizontal para jogar</h1>
            <div id="orientacao-imgs">
                <div class="grupo-imagem-orientacao">
                    <img id="icone-errado" src="../img/orientacao-img/Group30.svg" alt="">
                    <img src="../img/orientacao-img/Subtract.svg" alt="">
                    <h1 id="texto-orientacao-vertical">vertical</h1>
                </div>
                <img id="vetor-orientacao" src="../img/orientacao-img/Vector5.svg" alt="">
                <div class="grupo-imagem-orientacao" id="orientacao-grupo-horizontal">
                    <img id="icone-certo" src="../img/orientacao-img/Group176.svg" alt="">
                    <img id="img-celular-horizontal" src="../img/orientacao-img/Subtract-1.svg" alt="">
                    <h1 id="texto-orientacao-vertical">horizontal</h1>
                </div>
            </div>
        </div>

    </section>

    <div class='tela-jogo'>
        <header class="game-header">
            <a href="../index.html" class="link-logo">
                <img id="logo-header" src="../img/logo.png" alt="" class="logo grid-item">
            </a>
            <h2 id="title-jogo" class=""></h2>

            <!--VERIFICANDO A S√âRIE E DESABILITANDO A VISIBILIDADE PARA O USU√ÅRIO-->
            <h2></h2>
        </header>

        <main id="main-body" class="grid grid-full">
            <div id="modalInfo" class="modal">
                <div class="modal-content" id="modal-content">
                    <p id="instrucao-do-jogo">
                        Ol√°, voc√™ sabe como funciona o Jogo da Repeti√ß√£o ü§î? N√£o? Ent√£o vem c√° que eu te explico rapidinho, nele a gente te mostra uma sequ√™ncia de figuras que se repetem e voc√™ tem que nos mostrar quais s√£o essas figuras que est√£o se repetindo... Aah, j√° ia esquecendo üòÄ, √© s√≥ clicar e arrastar as figuras dispon√≠veis l√° embaixo para o n√∫cleo e montar a sua sequ√™ncia com as figuras que se repetem na mesma ordem e depois clicar em TERMINEI.
                    </p>             

                    <button id="botao-info-close"
                        onclick="document.getElementById('modalInfo').style.display='none'">Entendi
                    </button>
                    <button id="botao-de-voz-ligado">
                        <p id="texto-de-voz">&#128266;</p>
                    </button>
                </div>
            </div>
            <section class="game-section grid-center">
                <div id="box-instrucoes">
                    <div class="progresso-conquistas">
                        <p class="texto-progresso">Conquistas</p>
                        <div class="conquistas-conteiner" id="container-estrelas">
                            <div class="estrela-container">
                                <img class="estrela" src="../img/estrelas/star2.svg" alt="">
                                <p class="estrela-texto" id="texto1">?</p>
                            </div>
                            <div class="estrela-container">
                                <img class="estrela" src="../img/estrelas/star2.svg" alt="">
                                <p class="estrela-texto" id="texto2">?</p>
                            </div>
                            <div class="estrela-container">
                                <img class="estrela" src="../img/estrelas/star3.svg" alt="">
                                <p class="estrela-texto" id="texto3">?</p>
                            </div>
                            <div class="estrela-container">
                                <img class="estrela" src="../img/estrelas/star4.svg" alt="">
                                <p class="estrela-texto" id="texto4">?</p>
                            </div>
                        </div>
                    </div>
                    <img src="../img/sr-logico.png" alt="" id="mascote-instrucoes">
                    <article id="textbox-tutorial">
                        <p id="textbox-fase">Fase n&uacute;mero <span id="textbox-numero-fase">1</span>:</p>
                        <textarea id="texto-textbox" readonly>Preste aten√ß√£o √†s pe√ßas da sequ√™ncia e identifique quais est√£o se repetindo. Depois arraste as pe√ßas dispon√≠veis no fundo da p√°gina para a √°rea do n√∫cleo, montando as pe√ßas que se repetem. A ordem das pe√ßas deve ser respeitada.
                        </textarea>
                    </article>

                    <div class="conteiner-botoes">
                        <div class="botoes-janela">
                            <span id="span-fullscreen" class=""><i class="icofont-maximize"></i></span>
                            <a href="../index.html" id="span-textbox">
                                <i class="icofont-close icofont-2x"></i>
                            </a>
                        </div>

                        <div id="botoes-de-audio">
                            <button id="botao-ativar-voz">
                                <p id="botao-voz-instrucao">&#128266;</p>
                            </button>
                            <button id="botao-repetir-voz">
                                <p id="repetir-voz">&#128257;</p>
                            </button>
                            <button onclick="responsiveVoice.cancel()" id="span-about">
                                <p id="cancelar-voz">&#128263;</p>
                            </button>
                            <button id="span-about" onclick="document.getElementById('modalInfo').style.display='block'"class="">
                                ?
                            </button>
                        </div>
                    </div>
                </div>
                <section id='sequencias-conteiner'>
                    <h3 id="titulo-nucleo">Sequ√™ncia</h3>
                    <section id="container-nucleo" class="game-container">
                        <!-- Container que mostra o n√∫cleo de repeti√ß√£o -->
                    </section>
                    <h3 id="titulo-sequencia">N√∫cleo</h3>
                    <section id="container-sequencia" class="game-container dropzone grid">
                        <!-- Lugar onde as imagens s√£o dropadas -->
                    </section>
                    <button id="botao-resultado" onclick="check()">TERMINEI!</button>
                </section>
                <div class="formas-titulo">
                    <p class='container-formas-titulo'>Pe√ßas Dispon√≠veis</p>
                    <section id="container-formas" class="game-container dropzone">
                        <!-- Container das figuras que ser√£o arrastadas -->
                    </section>
                </div>



                <!-- O Modal do resultado positivo-->
                <div id="modalAcerto" class="modal">
                    <!-- Conte√∫do do Modal -->
                    <div class="modal-content">
                        <span id="modal-close-button" class="close">&times;</span>
                        <img class="modal-img-logico" src="../img/modal/logico-contente.svg" alt="">
                        <div class="modal-text-content">
                            <h2 class="titulo-modal">RESULTADO</h2>
                            <h2 id="resultado-jogo"></h2>
                            <button id="botao-proximo" onclick="fecharModal('acerto')">Pr√≥xima</button>
                        </div>
                    </div>
                </div>

                <!-- O Modal do resultado negativo-->
                <div id="modalErro" class="modal">
                    <!-- Conte√∫do do Modal -->
                    <div class="modalNegativo-content">
                        <span id="modalNegativo-close-button" class="close">&times;</span>
                        <img class="modal-img-logico" src="../img/modal/logico-confuso.svg" alt="">
                        <div class="modal-text-content">
                            <h2 class="titulo-modal">RESULTADO</h2>
                            <h2 id="resultadoNegativo-jogo">Ihh! Algo deu Errado</h2>
                            <button id="botao-retorno" onclick="fecharModal('erro')">Continuar</button>
                        </div>
                    </div>
                </div>

            <!--O Modal de conclus√£o do jogo-->
            <div id="modalFim">
                <div id="modalContent">
                    <div id="roboIcon"><img src="../img/modal/robo-end-quente.png" alt="Robo de festa"></div>
                    <div id="modalGlassQuente"></div>
                    <div id="modalBoxQuente">
                        <div id="textZone">
                            <h2>PARAB√âNS</h2>
                            <h3>Voc√™ concluiu o jogo!!!</h3>
                        </div>
                    </div>
                </div>
                <section id="botao-box">
                    <button id="botao-restart" class="botao-fim-quente">Reiniciar</button>
                    <button id="botao-certificado" class="botao-fim-quente">Certificado</button>
                </section>
            </div>
            </section>
        </main>

        <footer class="footer-grid">
            <p class="footer-text grid-center">Copyright Fapesq - <span id="ano">2021</span></p>
            <script>
                var ano = document.getElementById("ano");
                var anoAtual = new Date();
                ano.innerHTML = anoAtual.getFullYear();
            </script>
            <section class="grid-right">
                <p class="footer-text realizadores-text">Realizadores:</p>
                <div class="footer-imgs">
                    <img class="footer-img" id="logo-pb" src="../img/logo-pb.png" alt="">
                    <img class="footer-img" id="logo-seect" src="../img/logo-SEECT.png" alt="">
                    <img class="footer-img" id="logo-fapesq" src="../img/logo-fapesq.png" alt="">
                </div>
            </section>
        </footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/@shopify/draggable@1.0.0-beta.11/lib/draggable.bundle.js"></script>
    <script src="./script/game-script.js"></script>
    <script src="../script/page-script.js"></script>
    <script>
        var containerFormas = document.getElementById('container-formas');
        var containerSequencia = document.getElementById('container-sequencia');

        const droppableSequencia = new Draggable.Droppable(containerFormas, {
            draggable: '.game-img',
            dropzone: '.dropzone'
        });

        droppableSequencia.on('drag:start', () => {
            if (containerSequencia.classList.contains('draggable-dropzone--occupied')) {
                containerSequencia.classList.remove('draggable-dropzone--occupied');
            }
        });

        const retorno = new Draggable.Droppable(containerSequencia, {
            draggable: '.game-img',
            dropzone: '.dropzone'
        });

        retorno.on('drag:start', () => {
            if (containerFormas.classList.contains('draggable-dropzone--occupied')) {
                containerFormas.classList.remove('draggable-dropzone--occupied');
            }
        })
    </script>
    <script type="text/javascript">
        function descobreOs() {
            var userAgent = navigator.userAgent || navigator.vendor || window.opera;
            if (/windows phone/i.test(userAgent)) {
                return "Windows Phone";
            }
            if (/android/i.test(userAgent)) {
                return "Android";
            }
            if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                return "iOS";
            }
            return "n_sei";
        }

        var sistema = descobreOs();
        console.log(sistema)

        // <link rel="stylesheet" href="mobile-style.css" type="text/css" media="screen and (orientation: landscape) and (max-width: 700px)">
        if (sistema == 'Android') {

            let estilo = document.getElementById('estilo-mobile');
            estilo.setAttribute('media', 'screen and (orientation: landscape) and (max-width: 900px)');

        }

        if (sistema == 'iOS') {

            // Criando o CSS respons√°vel pelo modo Fullscreen
            var indexHead = document.getElementsByTagName('head')[0];
            var iosCss = document.createElement('link');
            iosCss.setAttribute('href', './game-ios-style.css');
            iosCss.setAttribute('rel', 'stylesheet');
            indexHead.appendChild(iosCss);
        }

        var textarea = document.getElementById('texto-textbox');
        var sentido

        function textRoll(timeInterval, timeTimeout) {
            sentido = 1
            var textareaClock = setInterval(() => {
                textarea.scrollTop = textarea.scrollTop + sentido;
                if (textarea.scrollTop == 27) {
                    sentido = -1;
                }
            }, timeInterval);

            setTimeout(() => {
                console.log('terminei')
                clearInterval(textareaClock)
            }, timeTimeout);
        }

        textRoll(90, 6000)
    </script>


    <script>
        let mudandoTituloRepeticao = document.getElementById('title-jogo');
        mudandoTituloRepeticao.innerHTML = localStorage.titulo;
    </script> 
    
    <script type="text/javascript">
        $('#botao-ativar-voz').on('click', function(){
            var texto = $("#texto-textbox").val();
            responsiveVoice.speak($("#texto-textbox").val(), "Brazilian Portuguese Female");
        });
    </script>

    <script type="text/javascript">
        $("#botao-repetir-voz").on('click', function(){
            var texto = $('#texto-textbox').val();
            responsiveVoice.speak($("#texto-textbox").val(), "Brazilian Portuguese Female");
        })
    </script>
</script>

    <script>
        //Var√≠√°vel para armazenar o texto que ser√° falado. Para mais falas, armazenar o texto em outra vari√°vel...
        var mensagemDuvida = "Ol√°, voc√™ sabe como funciona o Jogo da Repeti√ß√£o ü§î? N√£o? Ent√£o vem c√° que eu te explico rapidinho, nele a gente te mostra uma sequ√™ncia de figuras que se repetem e voc√™ tem que nos mostrar quais s√£o essas figuras que est√£o se repetindo... Aah, j√° ia esquecendo üòÄ, √© s√≥ clicar e arrastar as figuras dispon√≠veis l√° embaixo para o n√∫cleo e montar a sua sequ√™ncia com as figuras que se repetem na mesma ordem e depois clicar em TERMINEI.!";

        var voiceList = document.querySelector('#voiceList');
        var botaoDeVozLigado = document.querySelector('#botao-de-voz-ligado');
        var synth = window.speechSynthesis;
        var voices = [];

        //Coloca as vozes na caixa de sele√ß√£o de vozes...
        PopulateVoices();
        if(speechSynthesis !== undefined){
            speechSynthesis.onvoiceschanged = PopulateVoices;
        }

        //Criando um Listener para a fala da mensagem da vari√°vel mensagemDuvida...
        botaoDeVozLigado.addEventListener('click', ()=> {
            var toSpeak = new SpeechSynthesisUtterance(mensagemDuvida);
            var selectedVoiceName = voiceList.selectedOptions[0].getAttribute('data-name');
            voices.forEach((voice)=>{
                if(voice.name === selectedVoiceName){
                    toSpeak.voice = voice;
                }
            });
            synth.speak(toSpeak);
        });

        //Seleciona apenas as vozes em Portugues BR e descartas todas as demais para serem mostradas na sele√ß√£o de vozes...
        function PopulateVoices(){
            voices = synth.getVoices();
            var selectedIndex = voiceList.selectedIndex < 0 ? 0 : voiceList.selectedIndex;
            voiceList.innerHTML = '';
            voices.forEach((voice)=>{
                var listItem = document.createElement('option');
                if(voice.name == "Microsoft Maria - Portuguese (Brazil)"){
                    listItem.textContent = voice.name;
                    listItem.setAttribute('data-lang', voice.lang);
                    listItem.setAttribute('data-name', voice.name);
                    voiceList.appendChild(listItem);
                }
            });

            voiceList.selectedIndex = selectedIndex;
        }
    </script>
</body>

</html>